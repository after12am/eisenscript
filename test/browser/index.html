<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>eisenscript</title>
<style type="text/css">
body {
  font-family: Monospace;
  background-color: #202020;
  margin: 0px;
  overflow: hidden;
}
</style>
</head>
<body>
<script type="text/eisenscript" id="eisenscript">
// 10 * { x 1 hue 36 } 10 * { y 1 sat 0.9 } 10 * { z 1 b 0.9 } box
// 10 * { x 1 color random } 10 * { y 1 color random } 10 * { z 1 color random } box
// { m 1 0 0 0 .53 -.85 0 .85 .53 } box
// { s 10 } box
// 1 * { s 3 } 10 * { x 1 color #f00 } 10 * { y 1 blend #0f0 .04 } 10 * { z 1 blend #0f0 .04 } box
// { color #0f0} box

// set maxdepth 4
// rule R1 md 10 {
//   box
//   { x -1.6 } R1
// }
// R1
box
</script>
<script type="text/javascript" src="bower_components/jquery/jquery.js"></script>
<script type="text/javascript" src="scripts/three.min.js"></script>
<script type="text/javascript" src="scripts/dump.js"></script>
<script type="text/javascript" src="scripts/eisenscript.js"></script>
<script type="text/javascript">

var container, renderer, objects, n = 0;

function animate() {
  //requestAnimationFrame( animate );
  
  // if rendering one object at a time
  // renderer.build(objects[n]);
  // n++;
  
  // renderer.update();
  renderer.render();
}

$(function() {
  
  // compiling...
  var s = +new Date();
  objects = EISEN.compile($('#eisenscript').text());
  console.log('compile time:', (+new Date() - s) + 'ms');
  
  if (objects.error) {
    console.error(objects.error);
    return;
  }
  
  // rendering...
  var s = +new Date();
  renderer = new EISEN.TestRenderer(window.innerWidth, window.innerHeight, {
    materialType: window.navigator.userAgent.match('Chrome') ? 'basic' : 'lambert'
  })
  
  
  objects.forEach(function(object) {
    switch (object.type) {
      case 'background': renderer.clearColor(object.color); break;
      case 'primitive': renderer.addPrimitive(object); break;
    }
  });
  
  console.log('render time:', (+new Date() - s) + 'ms');
  
  // appending to body...
  container = document.createElement('div');
  document.body.appendChild(container);
  container.appendChild(renderer.domElement);
  
  // animating...
  animate();
});
</script>
</body>
</html>